<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Improved Logic B7 - Trade Engine Dashboard</title>
  <style>
    /* Global Styles */
    body {
      margin: 0;
      padding: 0;
      background: #0d1b2a;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    /* Centering the dashboard frame */
    #container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    /* Dashboard Frame */
    #dashboard {
      width: 806px;
      height: 704px;
      background: #001f3f;
      border: 2px solid #003366;
      display: grid;
      grid-template-columns: repeat(4, 200px);
      grid-template-rows: 200px 300px 200px;
      grid-template-areas:
        "A1 A2 A3 A4"
        "B1 B2 B2 B4"
        "C1 C2 C3 C4";
      gap: 2px;
    }
    .hidden { display: none !important; }
    /* Grid item styling */
    .grid-item {
      padding: 10px;
      box-sizing: border-box;
      max-height: 100%;
      overflow: auto;
      scrollbar-width: thin;
      scrollbar-color: transparent transparent;
      background: #012a4a;
      position: relative;
    }
    /* Grid area assignments */
    #A1 { grid-area: A1; }
    #A2 { grid-area: A2; }
    #A3 { grid-area: A3; }
    #A4 { grid-area: A4; }
    #B1 { grid-area: B1; }
    #B2 { grid-area: B2; }
    #B4 { grid-area: B4; }
    #C1 { grid-area: C1; }
    #C2 { grid-area: C2; }
    #C3 { grid-area: C3; }
    #C4 { grid-area: C4; }
    
    /* Logo styling */
    .logo {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
    }
    /* Input fields */
    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: calc(100% - 20px);
      padding: 5px;
      margin: 5px 0;
      box-sizing: border-box;
      background: #fff;
      color: #000;
      border: 1px solid #003366;
      border-radius: 4px;
    }
    /* Buttons */
    button {
      cursor: pointer;
      font-size: 12px;
      background: #003366;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    /* Label buttons */
    .label-btn {
      display: inline-block;
      width: 60px;
      height: 20px;
      line-height: 21px;
      text-align: center;
      border-radius: 10px;
      background: #003366;
      margin: 2px;
      font-size: 12px;
      cursor: pointer;
    }
    /* Table styling */
    table {
      width: 95%;
      margin: 0 auto;
      border-collapse: collapse;
      font-size: 12px;
      overflow: hidden;
      table-layout: fixed;
    }
    table, th, td {
      border: 1px solid #003366;
      padding: 4px;
      text-align: center;
    }
    /* Asset icon */
    .asset-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #003366;
      color: #fff;
      font-size: 10px;
      border: 1px solid #fff;
      margin: 2px;
      cursor: pointer;
    }
    /* Chart area in B2 */
    #B2 .chart-area {
      height: 200px;
      background: #012a4a;
      padding: 5px;
      border-bottom: 1px solid #003366;
    }
    #B2 .coin-container {
      overflow-x: auto;
      white-space: nowrap;
      height: 50px;
      margin-top: 5px;
      display: flex;
      gap: 5px;
    }
    #B2 .coin-container .asset-icon { margin-right: 5px; }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .modal-content {
      background: #001f3f;
      padding: 10px;
      width: 330px;
      height: 450px;
      display: grid;
      grid-template-rows: repeat(4, 1fr);
      gap: 5px;
      border: 1px solid #003366;
      border-radius: 8px;
    }
    .modal-row {
      border: 1px solid #003366;
      padding: 5px;
      overflow: auto;
    }
    .file-list {
      height: 100%;
      overflow-y: auto;
      border-right: 1px solid #003366;
    }
    .file-item {
      display: flex;
      align-items: center;
      font-size: 12px;
      margin: 2px 0;
    }
    .file-item span { margin-left: 5px; }
    .modal-buttons {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
    }
    /* Chat messages */
    .chat-messages {
      max-height: 120px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .chat-message {
      display: flex;
      align-items: center;
      padding: 4px 0;
      font-size: 12px;
      border-bottom: 1px solid #003366;
    }
    .chat-message .avatar { margin-right: 8px; }
    .chat-message .time {
      font-size: 10px;
      text-align: right;
      width: 40px;
    }
    /* Control buttons container fixed to the bottom-right outside the dashboard container */
    #controlButtons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #001f3f;
      padding: 10px;
      border: 2px solid #003366;
      border-radius: 8px;
    }
    #controlButtons button {
      margin: 0 5px;
      font-size: 12px;
      padding: 5px 10px;
      cursor: pointer;
    }
    /* Calculator Styles */
    #calculator {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      justify-items: center;
    }
    #calcDisplay {
      grid-column: span 4;
      width: 100%;
      padding: 5px;
      text-align: right;
    }
    .calc-btn {
      width: 100%;
      height: 40px;
    }
    .calc-wide {
      grid-column: span 2;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="dashboard">
      <!-- Row A -->
      <!-- A1: Login Block -->
      <div class="grid-item" id="A1">
        <div class="logo">üîë</div>
        <div style="margin-top:30px; text-align:center;">
          <input type="text" placeholder="Email">
          <input type="password" placeholder="Password">
          <div style="margin-top:5px;">
            <button>Start</button>
            <button>End</button>
          </div>
        </div>
      </div>
      <!-- A2: Piggy Bank / Balances Block -->
      <div class="grid-item" id="A2">
        <div class="logo">üêñ</div>
        <div class="scroll-container" style="margin-top:30px;">
          <table>
            <thead>
              <tr>
                <th>Asset</th>
                <th>Last Price</th>
                <th>Qty</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">INV</div></td>
                <td>‚ÇÆ1500</td>
                <td>100</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">MNT</div></td>
                <td>‚ÇÆ1</td>
                <td>1600</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">AUD</div></td>
                <td>‚ÇÆ2200</td>
                <td>100</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">CAR</div></td>
                <td>$15</td>
                <td>75</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- A3: Central Bank Block -->
      <div class="grid-item" id="A3">
        <div class="logo">üè¶</div>
        <div style="margin-top:30px; text-align:center;">
          <div class="asset-icon" onclick="openAssetModal()">USD</div>
        </div>
        <div style="margin-top:10px; text-align:center;">
          <button onclick="openCentralBankModal('mint')" style="width:23%;">Mint</button>
          <button onclick="openCentralBankModal('burn')" style="width:23%;">Burn</button>
          <button onclick="openCentralBankModal('transfer')" style="width:50%;">Transfer</button>
        </div>
      </div>
      <!-- A4: User Block -->
      <div class="grid-item" id="A4">
        <div class="logo">üë®‚Äçüíº</div>
        <div style="margin-top:30px; text-align:center;">
          <input type="text" placeholder="Bagi">
          <input type="text" placeholder="bat@gmail.com">
          <input type="text" placeholder="5021280612; Khaan">
          <div style="margin-top:0px;">
            <button>Update</button>
            <button>Hide</button>
          </div>
        </div>
      </div>
      
      <!-- Row B -->
      <!-- B1: Network Block with Hexagon Nodes -->
      <div class="grid-item" id="B1">
        <div class="logo">üåê</div>
        <div style="margin-top:35px; margin-left:10px; text-align:center;">
          <span class="label-btn">Nodes</span>
          <span class="label-btn">Peers</span>
        </div>
        <div style="position: relative; width:100%; height:100%;">
          <svg width="180" height="200" style="position:absolute;top:0;left:0;pointer-events:none">
            <g transform="translate(90,100)">
              <polygon points="60,0 30,52 -30,52 -60,0 -30,-52 30,-52" fill="none" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="60" y2="0" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="30" y2="52" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="-30" y2="52" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="-60" y2="0" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="-30" y2="-52" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <line x1="0" y1="0" x2="30" y2="-52" stroke="rgba(255,255,255,0.7)" stroke-width="2"/>
              <g font-size="10" text-anchor="middle" fill="#000">
                <g>
                  <circle cx="60" cy="0" r="8" fill="orange" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">1</text>
                </g>
                <g transform="rotate(60)">
                  <circle cx="60" cy="0" r="8" fill="orange" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">2</text>
                </g>
                <g transform="rotate(120)">
                  <circle cx="60" cy="0" r="8" fill="orange" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">3</text>
                </g>
                <g transform="rotate(180)">
                  <circle cx="60" cy="0" r="8" fill="green" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">4</text>
                </g>
                <g transform="rotate(240)">
                  <circle cx="60" cy="0" r="8" fill="green" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">5</text>
                </g>
                <g transform="rotate(300)">
                  <circle cx="60" cy="0" r="8" fill="green" style="filter:drop-shadow(0 0 2px rgba(0,0,0,0.5));"/>
                  <text x="60" y="4">6</text>
                </g>
              </g>
            </g>
          </svg>
        </div>
      </div>
      <!-- B2: Asset Chart & Coins Block -->
      <div class="grid-item" id="B2">
        <div class="logo">üìà</div>
        <div class="chart-area">
          <canvas id="lineChart" width="370" height="200"></canvas>
        </div>
        <div style="margin-top:10px; text-align:left;">
          <span class="label-btn">Investment</span>
          <span class="label-btn">Insurance</span>
          <span class="label-btn">Currency</span>
        </div>
        <div class="coin-container">
          <div class="asset-icon" onclick="openAssetModal()">GRT</div>
          <div class="asset-icon" onclick="openAssetModal()">AUD</div>
          <div class="asset-icon" onclick="openAssetModal()">MNT</div>
          <div class="asset-icon" onclick="openAssetModal()">CAR</div>
          <div class="asset-icon" onclick="openAssetModal()">NTR</div>
          <div class="asset-icon" onclick="openAssetModal()">BDI</div>
          <div class="asset-icon" onclick="openAssetModal()">GOB</div>
          <div class="asset-icon" onclick="openAssetModal()">BTC</div>
          <div class="asset-icon" onclick="openAssetModal()">TOK</div>
          <div class="asset-icon" onclick="openCentralBankModal('mint')">NEW</div>
        </div>
      </div>
      <!-- B4: Calculator Block -->
      <div class="grid-item" id="B4">
        <div class="logo">üßÆ</div>
        <div style="margin-top:30px; text-align:center;">
          <div id="calculator">
            <input type="text" id="calcDisplay" readonly>
            <button class="calc-btn" onclick="calcInput('7')">7</button>
            <button class="calc-btn" onclick="calcInput('8')">8</button>
            <button class="calc-btn" onclick="calcInput('9')">9</button>
            <button class="calc-btn" onclick="calcInput('/')">/</button>
            <button class="calc-btn" onclick="calcInput('4')">4</button>
            <button class="calc-btn" onclick="calcInput('5')">5</button>
            <button class="calc-btn" onclick="calcInput('6')">6</button>
            <button class="calc-btn" onclick="calcInput('*')">*</button>
            <button class="calc-btn" onclick="calcInput('1')">1</button>
            <button class="calc-btn" onclick="calcInput('2')">2</button>
            <button class="calc-btn" onclick="calcInput('3')">3</button>
            <button class="calc-btn" onclick="calcInput('-')">-</button>
            <button class="calc-btn" onclick="calcInput('0')">0</button>
            <button class="calc-btn" onclick="calcInput('.')">.</button>
            <button class="calc-btn" onclick="calculateResult()">=</button>
            <button class="calc-btn" onclick="calcInput('+')">+</button>
            <button class="calc-btn calc-wide" onclick="clearCalc()">Clear</button>
            <button class="calc-btn" onclick="backspaceCalc()">‚å´</button>
          </div>
        </div>
      </div>
      
      <!-- Row C -->
      <!-- C1: Chat Block -->
      <div class="grid-item" id="C1">
        <div class="logo">üí¨</div>
        <div style="margin-top:0px; margin-left:28px; text-align:center;">
          <span class="label-btn">Private</span>
          <span class="label-btn">Public</span>
        </div>
        <div class="chat-messages" id="chatMessages">
          <div class="chat-message">
            <div class="asset-icon avatar">üë®‚Äçüíº</div>
            <div class="message" style="flex:1; text-align:left;">Hello!</div>
            <div class="time">12:00</div>
          </div>
          <div class="chat-message">
            <div class="asset-icon avatar">ü§†</div>
            <div class="message" style="flex:1; text-align:left;">bond.mn</div>
            <div class="time">14:25</div>
          </div>
          <div class="chat-message">
            <div class="asset-icon avatar">üòé</div>
            <div class="message" style="flex:1; text-align:left;">Bond transferred for storage</div>
            <div class="time">20:00</div>
          </div>
        </div>
        <div class="block-content">
          <input type="text" placeholder="User" id="chatUser" style="margin-right:4px;">
          <input type="text" placeholder="Message" id="chatMsg" style="margin-right:4px;">
          <button onclick="sendChat()">Send</button>
          <button onclick="document.getElementById('chatMsg').value=''">Cancel</button>
        </div>
      </div>
      <!-- C2: Order Book Block -->
      <div class="grid-item" id="C2">
        <div class="logo">üìã</div>
        <div style="margin-top:15px; margin-left:10px; padding:0 10px;">
          <div class="order-book" style="font-size:12px; display:flex; flex-direction:column; gap:8px; background:#001f3f; padding:10px; border-radius:5px;">
            <div style="display:flex; flex-direction:column; gap:4px;">
              <div style="font-weight:bold; color:#FF4136; text-align:center;">SELL</div>
              <div style="color:#FF4136; display:flex; justify-content:space-between;">
                <span>Price: 2220</span>
                <span>Qty: 50</span>
              </div>
              <div style="color:#FF4136; display:flex; justify-content:space-between;">
                <span>Price: 2210</span>
                <span>Qty: 30</span>
              </div>
              <div style="color:#FF4136; display:flex; justify-content:space-between;">
                <span>Price: 2200</span>
                <span>Qty: 70</span>
              </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:4px;">
              <div style="font-weight:bold; color:#2ECC40; text-align:center;">BUY</div>
              <div style="color:#2ECC40; display:flex; justify-content:space-between;">
                <span>Price: 2190</span>
                <span>Qty: 60</span>
              </div>
              <div style="color:#2ECC40; display:flex; justify-content:space-between;">
                <span>Price: 2180</span>
                <span>Qty: 40</span>
              </div>
              <div style="color:#2ECC40; display:flex; justify-content:space-between;">
                <span>Price: 2170</span>
                <span>Qty: 80</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- C3: Asset Trade Block -->
      <div class="grid-item" id="C3">
        <div class="logo">üí±</div>
        <div style="margin-top:30px; text-align:center;">
          <div class="asset-icon" onclick="openAssetModal()">AUD</div>
        </div>
        <div style="margin-top:10px; text-align:center;">
          <input type="number" placeholder="Quantity" style="width:80px;">
          <input type="number" placeholder="Price" style="width:80px;">
        </div>
        <div style="text-align:center;">
          <button>Buy</button>
          <button>Sell</button>
        </div>
      </div>
      <!-- C4: Recent Transactions Block -->
      <div class="grid-item" id="C4">
        <div class="logo">ü§ù</div>
        <div style="margin-top:0px; margin-left:28px; text-align:center;">
          <span class="label-btn">Audit</span>
          <span class="label-btn">Market</span>
        </div>
        <div class="scroll-container" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Asset</th>
                <th>Message</th>
                <th>Qty</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">LMN</div></td>
                <td>Txn OK</td>
                <td>25</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">APL</div></td>
                <td>Txn OK</td>
                <td>25</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">AUD</div></td>
                <td>Mint!</td>
                <td>25</td>
              </tr>
              <tr>
                <td><div class="asset-icon" onclick="openAssetModal()">LMN</div></td>
                <td>Txn OK</td>
                <td>25</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div>
          <button>Print</button>
          <button>Report</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Control Buttons (outside the dashboard) -->
  <div id="controlButtons">
    <button onclick="setGridTemplate('default')">Default Layout</button>
    <button onclick="setGridTemplate('alternate')">Alternate Layout</button>
  </div>
  
  <!-- Modal: Asset Details -->
  <div id="assetModal" class="modal">
    <div class="modal-content">
      <div class="modal-row" style="margin-left:5px; font-size:12px;">
        <div style="margin-top:15px; text-align:center;">
          <div class="asset-icon" style="width:30px; height:30px; font-size:12px; margin:auto;">GRT</div>
          <p>Total supply: 1,000,000</p>
        </div>
      </div>
      <div class="modal-row">
        <div style="overflow-x:auto; white-space:nowrap;">
          <div style="display:inline-block; margin-right:5px; text-align:center;">
            <img src="./image1.jpg" width="80" height="60" alt="img1"><br>
            <small>01/01</small>
          </div>
          <div style="display:inline-block; margin-right:5px; text-align:center;">
            <img src="./image2.jpg" width="80" height="60" alt="img2"><br>
            <small>01/02</small>
          </div>
          <div style="display:inline-block; margin-right:5px; text-align:center;">
            <img src="./image3.jpg" width="80" height="60" alt="img3"><br>
            <small>01/03</small>
          </div>
        </div>
      </div>
      <div class="modal-row" style="margin-left:5px; font-size:14px;">
        <p>üíé Premium grade holiday house in Gachuurt, Mongolia.</p>
      </div>
      <div class="modal-row" style="display:flex;">
        <div class="file-list" style="width:60%; padding-right:5px;">
          <div class="file-item">[PDF] <span>Khudaldah geree.pdf</span></div>
          <div class="file-item">[PDF] <span>Gerchilgee.pdf</span></div>
          <div class="file-item">[PDF] <span>Gazar.pdf</span></div>
          <div class="file-item">[PDF] <span>Plan zurag.pdf</span></div>
        </div>
        <div class="modal-buttons" style="width:40%;">
          <button>Action</button>
          <button onclick="closeModal('assetModal')">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal: Central Bank -->
  <div id="centralBankModal" class="modal">
    <div class="modal-content" style="grid-template-rows: auto auto 1fr auto;">
      <div style="text-align:center; font-weight:bold; font-size:16px;">üè¶</div>
      <div style="margin-top:10px; text-align:center;">
        <div class="asset-icon" style="width:30px; height:30px; font-size:14px; margin:auto;">XYZ</div>
      </div>
      <div style="padding:5px;">
        <input type="number" placeholder="Quantity" id="cbQuantity" style="width:70%; margin:10px auto; display:block;">
        <input type="text" placeholder="From" id="cbFrom" style="width:70%; margin:10px auto; display:block;">
        <input type="text" placeholder="To" id="cbTo" style="width:70%; margin:10px auto; display:block;">
        <input type="text" placeholder="Message" id="cbMessage" style="width:70%; margin:10px auto; display:block;">
      </div>
      <div style="text-align:center;">
        <button id="cbAction">Action</button>
        <button onclick="closeModal('centralBankModal')">Cancel</button>
      </div>
    </div>
  </div>
  
  <!-- Scripts -->
  <script>
    // Modal Functions
    function openModal(id) {
      document.getElementById(id).style.display = "flex";
    }
    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }
    function openAssetModal() {
      openModal('assetModal');
    }
    
    // Central Bank Logic
    var currentCentralAction = "";
    function openCentralBankModal(actionType) {
      currentCentralAction = actionType; // save the action for later use
      openModal('centralBankModal');
      // Reset visibility for both fields
      document.getElementById('cbFrom').classList.remove('hidden');
      document.getElementById('cbTo').classList.remove('hidden');
      if (actionType === 'mint') {
        document.getElementById('cbFrom').classList.add('hidden');
        document.getElementById('cbAction').innerText = "Mint";
      } else if (actionType === 'burn') {
        document.getElementById('cbTo').classList.add('hidden');
        document.getElementById('cbAction').innerText = "Burn";
      } else if (actionType === 'transfer') {
        document.getElementById('cbAction').innerText = "Transfer";
      }
    }
    function processCentralBankAction() {
      var quantity = parseFloat(document.getElementById('cbQuantity').value);
      var from = document.getElementById('cbFrom').value;
      var to = document.getElementById('cbTo').value;
      var message = document.getElementById('cbMessage').value;
      
      if (!quantity || quantity <= 0) {
        alert('Please enter a valid positive quantity.');
        return;
      }
      if (currentCentralAction === 'transfer' && (!from || !to)) {
        alert('For a transfer, please enter both "From" and "To" addresses.');
        return;
      }
      switch (currentCentralAction) {
        case 'mint':
          console.log('Minting', quantity, 'assets.', message);
          break;
        case 'burn':
          console.log('Burning', quantity, 'assets.', message);
          break;
        case 'transfer':
          console.log('Transferring', quantity, 'assets from', from, 'to', to, message);
          break;
        default:
          console.error('Unknown action type:', currentCentralAction);
      }
      alert(currentCentralAction.charAt(0).toUpperCase() + currentCentralAction.slice(1) + ' operation completed.');
      closeModal('centralBankModal');
    }
    document.getElementById('cbAction').onclick = processCentralBankAction;
    
    // Trade Engine Logic
    class Order {
      constructor(id, type, price, quantity, timestamp = Date.now()) {
        this.id = id;
        this.type = type; // 'buy' or 'sell'
        this.price = price;
        this.quantity = quantity;
        this.timestamp = timestamp;
      }
    }
    class OrderBook {
      constructor() {
        this.buyOrders = [];
        this.sellOrders = [];
        this.orderIdCounter = 1;
      }
      addOrder(type, price, quantity) {
        const order = new Order(this.orderIdCounter++, type, price, quantity);
        if (type === 'buy') {
          this.buyOrders.push(order);
          this.buyOrders.sort((a, b) => b.price - a.price || a.timestamp - b.timestamp);
        } else if (type === 'sell') {
          this.sellOrders.push(order);
          this.sellOrders.sort((a, b) => a.price - b.price || a.timestamp - b.timestamp);
        }
        console.log(`Order added: ${JSON.stringify(order)}`);
        this.matchOrders();
      }
      matchOrders() {
        while (this.buyOrders.length && this.sellOrders.length &&
               this.buyOrders[0].price >= this.sellOrders[0].price) {
          const buyOrder = this.buyOrders[0];
          const sellOrder = this.sellOrders[0];
          const tradedQuantity = Math.min(buyOrder.quantity, sellOrder.quantity);
          const tradePrice = sellOrder.price;
          console.log(`Trade executed: ${tradedQuantity} units @ ${tradePrice} between BuyOrder ${buyOrder.id} and SellOrder ${sellOrder.id}`);
          buyOrder.quantity -= tradedQuantity;
          sellOrder.quantity -= tradedQuantity;
          if (buyOrder.quantity === 0) this.buyOrders.shift();
          if (sellOrder.quantity === 0) this.sellOrders.shift();
        }
      }
    }
    var orderBook = new OrderBook();
    function placeBuyOrder() {
      var price = parseFloat(prompt("Enter buy order price:"));
      var quantity = parseFloat(prompt("Enter buy order quantity:"));
      if (!isNaN(price) && !isNaN(quantity) && price > 0 && quantity > 0) {
        orderBook.addOrder('buy', price, quantity);
      } else {
        alert("Invalid input for buy order.");
      }
    }
    function placeSellOrder() {
      var price = parseFloat(prompt("Enter sell order price:"));
      var quantity = parseFloat(prompt("Enter sell order quantity:"));
      if (!isNaN(price) && !isNaN(quantity) && price > 0 && quantity > 0) {
        orderBook.addOrder('sell', price, quantity);
      } else {
        alert("Invalid input for sell order.");
      }
    }
    window.placeBuyOrder = placeBuyOrder;
    window.placeSellOrder = placeSellOrder;
    
    // Calculator Functions
    function calcInput(value) {
      var display = document.getElementById('calcDisplay');
      display.value += value;
    }
    function calculateResult() {
      var display = document.getElementById('calcDisplay');
      try {
        display.value = eval(display.value);
      } catch (e) {
        display.value = "Error";
      }
    }
    function clearCalc() {
      document.getElementById('calcDisplay').value = "";
    }
    function backspaceCalc() {
      var display = document.getElementById('calcDisplay');
      display.value = display.value.slice(0, -1);
    }
    
    // Grid Layout Control
    function setGridTemplate(template) {
      var dashboard = document.getElementById('dashboard');
      if (template === 'default') {
        dashboard.style.gridTemplateAreas =
          `"A1 A2 A3 A4"
           "B1 B2 B2 B4"
           "C1 C2 C3 C4"`;
      } else if (template === 'alternate') {
        // Fixed closing quote issue:
        dashboard.style.gridTemplateAreas =
          `"B2 B2"
           "C2 C3"
           "A1 A2"`;
      }
    }
    
    // Chat Functionality
    function sendChat() {
      var user = document.getElementById('chatUser').value;
      var msg = document.getElementById('chatMsg').value;
      if (user && msg) {
        var chatMessages = document.getElementById('chatMessages');
        var messageDiv = document.createElement('div');
        messageDiv.className = "chat-message";
        messageDiv.innerHTML = '<div class="asset-icon avatar">' + user.substring(0, 2).toUpperCase() +
          '</div><div class="message" style="flex:1; text-align:left;">' + msg +
          '</div><div class="time">' + new Date().toLocaleTimeString() + '</div>';
        chatMessages.appendChild(messageDiv);
        document.getElementById('chatMsg').value = "";
      }
    }
    
    // Draw a simple line chart on window load
    window.onload = function() {
      var ctx = document.getElementById('lineChart').getContext('2d');
      ctx.beginPath();
      ctx.moveTo(0, 120);
      ctx.lineTo(50, 100);
      ctx.lineTo(100, 140);
      ctx.lineTo(150, 90);
      ctx.lineTo(200, 110);
      ctx.lineTo(250, 100);
      ctx.lineTo(300, 130);
      ctx.lineTo(350, 80);
      ctx.lineTo(380, 120);
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 2;
      ctx.stroke();
    };
  </script>
</body>
</html>
